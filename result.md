## Code review и анализ проекта

Проект состоит из статического фронтенда (минималистичный премиум‑UI) и лёгкой PHP‑CMS:
- Фронт: адаптивная вёрстка, стеклянный хедер, секции, компоненты.
- Бэк: `index.php` (роутинг), `install.php` (установщик), `admin/*` (панель), `includes/*` (DB, auth, helpers), MySQL‑схема (`schema.sql`).

### Сильные стороны
- Простая архитектура — легко разворачивать на shared‑хостинге.
- Установщик, который создаёт конфиг/схему и импортирует стартовые страницы.
- CRUD страниц и постов, WYSIWYG (TinyMCE), медиа‑менеджер.
- Динамический sitemap, базовые заголовки безопасности, относительные ссылки.

### Зоны риска и технический долг
1) Безопасность
   - [!] Загрузка файлов без валидации типа/размера; отсутствует защита от исполнения скриптов в `uploads/`.
   - [~] CSRF есть в редакторах, но отсутствует в логине.
   - [~] Роли есть в БД, но не применяются в контроле доступа (настройки/системные действия).
2) Управляемость
   - Нет удаления страниц/постов из панели.
   - Нет предпросмотра черновиков (просроченные публикации не посмотреть без публикации).
   - Настроек мало; не хватает секретного токена для предпросмотра.
3) Надёжность/UX
   - Медиа‑менеджер не валидирует размер/тип и не защищён .htaccess.
   - Преобразование ссылок в `index.php` (замена `href="/`) может повлиять на инлайн‑скрипты/атрибуты.

### Предложенные улучшения (и их статус)
- [✓] Безопасные загрузки: whitelist типов/размер, `.htaccess` в `uploads/` для запрета исполнения.
- [✓] CSRF на логине.
- [✓] Применение ролей: `editor` не видит "Настройки".
- [✓] Предпросмотр черновиков по токену (`preview_secret`) — параметр `?preview=1&token=...`.
- [✓] Удаление страниц/постов из админки.
- [✓] Просмотр журнала действий (audit log) в панели.
- [✓] Динамический sitemap уже реализован (подтвердил работу).
- [ ] Редактор меню (drag&drop), генерация статического кеша — можно добавить позже.

---

## Внесённые доработки
1) Загрузки/безопасность
   - Media: валидация MIME/расширений, лимит размера, уникальные имена.
   - `uploads/.htaccess`: отключено исполнение скриптов.
2) Авторизация/CSRF/роли
   - CSRF в `admin/login.php`.
   - Функции ролей и ограничение доступа к "Настройкам" для `editor`.
3) Предпросмотр и контент‑флоу
   - `preview_secret` в `settings`; предпросмотр черновиков через `?preview=1&token=...`.
4) Управление контентом
   - Кнопки удаления для страниц/постов + эндпоинты.
   - Страница просмотра аудита в админке.

## Дальнейшие шаги (рекомендации)
- Меню‑редактор (таблица `navigation` + drag&drop UI), подключение к шаблону.
- Версионность контента и откат (таблица `revisions`).
- Кнопка «Опубликовать позже» (поле `published_at`) и автогенерация sitemap on‑demand.
- Интеграция загрузки изображений из TinyMCE (file picker в `media.php`).
- Тесты smoke (GitHub Actions) и деплой на прод.
